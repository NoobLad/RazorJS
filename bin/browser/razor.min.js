/*
  razorjs 0.2.1 <https://github.com/andyedinborough/RazorJS>
  Copyright (c) 2013 Andy Edinborough (@andyedinborough)
  Released under MIT License
*/
(function(t,e,n){"use strict";function i(t){return t&&(t+"").indexOf("[native code]")>-1?t:n}function r(t){return p(arguments,function(e,n){0!==n&&e&&p(y(e),function(n){t[n]=e[n]})}),t}function o(t){var e=t.indexOf("{");return t.substr(0,e+1)+"\r\n"+t.substring(e+1,t.lastIndexOf("}"))+'; return ""; }'}function u(t){return t.split("\\").join("\\\\").split("\r").join("\\r").split("\n").join("\\n").split('"').join('\\"')}function s(t){return{toString:function(){return t},isHtmlString:!0}}function a(t){return(t=t||"").substr(t.length-1)}function l(t){var e,i,r,u=new x(t),s=arguments[1]||0,f=arguments[2]||0,h=[],c=[],p=[],g=function(){if(i=u.peek(),"*"===i)u.readUntil("*@");else if("("===i)r=u.readBlock("(",")"),h.push(r.substr(1,r.length-2),1);else if("{"===i)r=u.readBlock("{","}"),h.push(l(r.substr(1,r.length-2),s+1,1).join("\n"));else if(":"===i&&1===f){for(r=u.readUntil("\n","@","}");"@"===r.next&&"@"===u.peek();){var t=u.readUntil("\n","@","}");r.value+=t.value,r.next=t.next}u.seek(-1),r.value=r.value.substr(1),h.push(r.value,2)}else if("i"===i&&"if"===u.peek(2)||"d"===i&&"do"===u.peek(2)||"f"===i&&"for"===u.peek(3)||"w"===i&&"while"===u.peek(5)||"h"===i&&"helper"===u.peek(6)||"s"===i&&"section"===u.peek(7)){if(r=u.readBlock("{","}"),"i"===i)for(;!u.eof();){var n=u.readWhitespace();if(!n)break;if("else"!==u.peek(4)){u.seek(-n.length);break}r+=n+u.readBlock("{","}")}var o=l(r.substr(0,r.length-1),s+1,1).join("\n")+"}",d=o.indexOf("(");"h"===i?c.push("function "+o.substr(7)):"s"===i?p.push("page.sections."+o.substr(8,d-8)+" = function"+o.substr(d)):h.push(o)}else if(i&&!k.test(a(e.value))){var g,v;for(r="";!u.eof()&&(g=u.text.substr(u.position+1),v=g.match(k))&&(r+=u.read(v[0].length),i=u.peek());)if("["===i||"("===i){r+=u.readBlock(i,"["===i?"]":")");break}r&&h.push(r,1)}else 0===f&&e.next&&h.push("@",2)};for(h.push=function(t){return function(e,i){"string"==typeof e&&(e=[e]),e=d(e,function(t){return t.code!==n?t:new w(t,i)}),t.apply(this,e)}}(h.push);!u.eof()&&(e=0===f?u.readUntil("@"):u.readQuotedUntil("@","<"));){for(;;){if(i=u.peek(),"@"===i&&(e.value+=u.read()),1===f&&"<"===e.next){var v=!1,y=(u.text.substr(u.position+1,30).match(b)||0)[0]||"";if(!y){var j=u.readQuotedUntil("@","<");e.value+=e.next+j.value,e.next=j.next;continue}for(h.push(e.value,0);!u.eof()&&(e=u.readUntil("@",">"),"@"==e.next);)h.push((v?"":"<")+e.value,2),v=!0,g();if(r=e+"","/"!==a(e.value)){for(var U,S=1;S>0&&(U=u.readQuotedUntil(["</"+y,"<"+y]),r+=U,!u.eof());)S+="/"===U.next.substr(1,1)?-1:1;r+=u.readQuotedUntil(">")}v||(r="text"===y?r.substr(5,r.length-5-7):"<"+r),h.push(l(r,s+1,0))}else e.value&&(0===f?h.push(e.value,2):h.push(e.value));break}g()}return s>0?h:(t=h.join("\r\n"),t=m.replace("#0",t).replace("#1",d(c,o).join("\r\n")).replace("#2",d(p,o).join("\r\n")))}function f(e,n){var i,o=l(e);try{i=Function(o)}catch(u){throw t.console.error(u.message+": "+o),u.message+": "+o}return function a(t,e,o){if(!o&&"function"==typeof e)return a(t,null,e);var u=r({writer:[]},e||{},U,n,{model:t}),l=i.apply(u);return u.layout&&O.view(u.layout,null,function(t){var e=[];u.writeLiteral=function(t){e.push(t)},l=t(null,{writer:e,sections:r({},u.sections),renderBody:function(){return s(l)}}),o&&o(l)}),l}}function h(t,e,i){if(!i&&"function"==typeof e)return h(t,n,e);var r="~/"+t,o=S[r],u=B[r],s=O.getViewEtag(t);return!o||s!==u||O.cacheDisabled?(O.findView(t,function(t){t&&(o=S[r]=O.compile(t,e),B[r]=s),i&&i(o)}),o):i?(i(o),n):o}var c=function(t){return function(e,n){return t.apply(e,[n])}},p=c(i(Array.prototype.forEach)||function(e,n){for(var i,r=this.length,o=r,u=n||t;o--;)e.apply(u,[this[i=r-o-1],i])}),d=c(i(Array.prototype.map)||function(e,n){for(var i=n||t,r=[],o=0,u=this.length;u>o;++o)r.push(e.call(i,this[o],o,this));return r}),g=c(i(Array.prototype.some)||function(e,n){for(var i=n||t,r=0,o=this.length;o>r;++r)if(e.call(i,this[r],r,this))return!0;return!1}),v="toString valueOf".split(" "),y=i(Object.keys)||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return p(v,function(n){t[n]!==Object.prototype[n]&&e.push(n)}),e},x=function(){function t(t,e,n){function r(e){return o=e.length,l=u[o]||(u[o]=t.peek(o)),l===e}for(var o,u=[],s="",l="";!t.eof();){if(u.length=0,n===g(e,r))return n?t.seek(o):(l=a(s),s=s.length>0?s.substr(0,s.length-1):""),i.create(s,l);if(l=t.read(),!l)break;s+=l}return i.create(s,l)}var e=function(t){this.text=(t||"")+"",this.position=-1,this.length=this.text.length},i=e.Chunk=function(t,e){return this.value=t||"",this.next=e||"",t||e?(this.length=(this.value+this.next).length,n):""};return r(i.prototype,{length:0,toString:function(){return this.value+this.next+""}}),i.create=function(t,e){return t||e?new i(t,e):""},r(e.prototype,{eof:function(){return this.position>=this.length},read:function(t){var e=this.peek(t);return this.position=Math.min(this.length,this.position+(t||1)),e},readAll:function(){if(this.position>=this.length)return n;var t=this.text.substr(this.position+1);return this.position=this.length,t},peek:function(t){return this.position+1>=this.length?n:this.text.substr(this.position+1,t||1)},seek:function(t,e){return this.position=Math.max(0,Math.min(this.length,(0===e?0:2===e?this.length:this.position)+(t||1))),this.position===this.length},readUntil:function(e){return"string"==typeof e&&(e=[].slice.call(arguments)),t(this,e,!0)},readWhile:function(e){return"string"==typeof e&&(e=[].slice.call(arguments)),t(this,e,!1)}}),e}(),k=/^[a-z0-9\._]+/i,b=/^[a-z]+(?:\:[a-z]+)?/i;x.prototype.readWhitespace=function(){return this.readWhile("\r","\n","	"," ")},x.prototype.readQuoted=function(t){for(var e,n="";;){if(e=this.readUntil(t),!e)break;if(n+=e.value+e.next,"\\"!==a(e.value))break}return n},x.prototype.readQuotedUntil=function(t){var e,n="";for("string"==typeof t&&(t=[].slice.call(arguments)),t=['"',"'","@*"].concat(t);e=this.readUntil(t);)if(n+=e.value,'"'===e.next||"'"===e.next)n+=e.next+this.readQuoted(e.next);else{if("@*"!==e.next)break;this.readUntil("*@")}return x.Chunk.create(n,e.next)},x.prototype.readBlock=function(t,e,n){var i,r=[t,e],o="";for(n=n||0;i=this.readUntil(r);){if(o+=i.value,i.next===t?n++:i.next===e&&n--,0===n)return o+=i.next;o+=i.next}return o};var w=function(t,e){this.code=t||"",this.type=e||0};r(w.prototype,{type:0,code:"",toString:function(){var t=this.code;return 0===this.type?t:2===this.type?'page.writeLiteral("'+u(t)+'");':"page.write("+t+");"}});var m='var page = this, writer = page.writer, model = page.model, html = page.html;\n#1\n#2\n#0\nreturn writer.join("");',j={encode:function(t){return(null===t||t===n)&&(t=""),t.isHtmlString?t:("string"!=typeof t&&(t+=""),t=t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;"),j.raw(t))},attributeEncode:function(t){return j.encode(t)},raw:function(t){return s(t)},renderPartial:function(t,e){return this.raw(O.view(t)(e))}},U={html:j,write:function(t){this.writeLiteral(this.html.encode(t))},writeLiteral:function(t){this.writer.push(t)},sections:{},isSectionDefined:function(t){return"function"==typeof this.sections[t]},renderSection:function(t,e){if(this.isSectionDefined(t))return s(this.sections[t]());if(e)throw'Section "'+t+'" not found.'}},S={},B={},O={view:h,compile:f,parse:l,findView:null,basePage:U,Cmd:w,extend:r,render:function(t,e,n){return f(t)(e,n)},getViewEtag:function(t){return t},views:S,etags:B,cacheDisabled:!1},Q=t.document.getElementsByTagName("script");O.findView=function(t,e){for(var n,i=0,r=Q.length;r>i&&(n=Q[i]);i++)if("application/x-razor-js"===n.type&&n.getAttribute("data-view-id")===t)return"function"==typeof e&&e(n.innerHTML),n.innerHTML},t.Razor=O})(global,module);