/*
  razorjs 0.2.0 <https://github.com/andyedinborough/RazorJS>
  Copyright (c) 2013 Andy Edinborough (@andyedinborough)

  Released under MIT License
*/
(function(e,t){"use strict";function n(e){if(e&&(e+"").indexOf("[native code]")>-1)return e}function f(e){return i(arguments,function(t,n){if(n===0)return;t&&i(a(t),function(n){e[n]=t[n]})}),e}function l(e){var t=e.indexOf("{");return e.substr(0,t+1)+"\r\n"+e.substring(t+1,e.lastIndexOf("}"))+'; return ""; }'}function c(e){return e.split("\\").join("\\\\").split("\r").join("\\r").split("\n").join("\\n").split('"').join('\\"')}function h(e){return{toString:function(){return e},isHtmlString:!0}}function m(e){return(e=e||"").substr(e.length-1)}function b(e){var t=new p(e),n=arguments[1]||0,r=arguments[2]||0,i=[],o=[],u=[],a,f,c,h=function(){f=t.peek();if(f==="*")t.readUntil("*@");else if(f==="(")c=t.readBlock("(",")"),i.push(c.substr(1,c.length-2),1);else if(f==="{")c=t.readBlock("{","}"),i.push(b(c.substr(1,c.length-2),n+1,1).join("\n"));else if(f===":"&&r===1){c=t.readUntil("\n","@","}");while(c.next==="@"&&t.peek()==="@"){var e=t.readUntil("\n","@","}");c.value+=e.value,c.next=e.next}t.seek(-1),c.value=c.value.substr(1),i.push(c.value,2)}else if(f==="i"&&t.peek(2)==="if"||f==="d"&&t.peek(2)==="do"||f==="f"&&t.peek(3)==="for"||f==="w"&&t.peek(5)==="while"||f==="h"&&t.peek(6)==="helper"||f==="s"&&t.peek(7)==="section"){c=t.readBlock("{","}");if(f==="i")while(!t.eof()){var s=t.readWhitespace();if(!s)break;if(t.peek(4)!=="else"){t.seek(-s.length);break}c+=s+t.readBlock("{","}")}var l=b(c.substr(0,c.length-1),n+1,1).join("\n")+"}",h=l.indexOf("(");f==="h"?o.push("function "+l.substr(7)):f==="s"?u.push("page.sections."+l.substr(8,h-8)+" = function"+l.substr(h)):i.push(l)}else if(f&&!d.test(m(a.value))){var p,v;c="";while(!t.eof()){p=t.text.substr(t.position+1),v=p.match(d);if(!v)break;c+=t.read(v[0].length),f=t.peek();if(!f)break;if(f==="["||f==="("){c+=t.readBlock(f,f==="["?"]":")");break}}c&&i.push(c,1)}else r===0&&a.next&&i.push("@",2)};i.push=function(e){return function(t,n){typeof t=="string"&&(t=[t]),t=s(t,function(e){return typeof e.code!="undefined"?e:new g(e,n)}),e.apply(this,t)}}(i.push);while(!t.eof()){a=r===0?t.readUntil("@"):t.readQuotedUntil("@","<");if(!a)break;for(;;){f=t.peek(),f==="@"&&(a.value+=t.read());if(r===1&&a.next==="<"){var w=!1,E=(t.text.substr(t.position+1,30).match(v)||0)[0]||"";if(!E){var T=t.readQuotedUntil("@","<");a.value+=a.next+T.value,a.next=T.next;continue}i.push(a.value,0);while(!t.eof()){a=t.readUntil("@",">");if(a.next!="@")break;i.push((w?"":"<")+a.value,2),w=!0,h()}c=a+"";if(m(a.value)!=="/"){var S=1,x;while(S>0){x=t.readQuotedUntil(["</"+E,"<"+E]),c+=x;if(t.eof())break;S+=x.next.substr(1,1)==="/"?-1:1}c+=t.readQuotedUntil(">")}w||(E==="text"?c=c.substr(5,c.length-5-7):c="<"+c),i.push(b(c,n+1,0))}else a.value&&(r===0?i.push(a.value,2):i.push(a.value));break}h()}return n>0?i:(e=i.join("\r\n"),e=y.replace("#0",e).replace("#1",s(o,l).join("\r\n")).replace("#2",s(u,l).join("\r\n")),e)}function S(t,n){var r,i=b(t);try{r=new Function(i)}catch(s){throw e.console.error(s.message+": "+i),s.message+": "+i}return function o(e,t,i){if(!i&&typeof t=="function")return o(e,null,t);var s=f({writer:[]},t||{},E,n,{model:e}),u=r.apply(s);return s.layout&&N.view(s.layout,null,function(e){var t=[];s.writeLiteral=function(e){t.push(e)},u=e(null,{writer:t,sections:f({},s.sections),renderBody:function(){return h(u)}}),i&&i(u)}),u}}function T(e,n,r){if(!r&&typeof n=="function")return T(e,t,n);var i=x["~/"+e];if(!i){var s;return N.findView(e,function(t){t&&(i=x["~/"+e]=N.compile(t,n)),r&&r(i)}),i}if(!r)return i;r(i)}var r=function(e){return function(t,n){return e.apply(t,[n])}},i=r(n(Array.prototype.forEach)||function(t,n){var r=this.length,i=r,s,o=n||e;while(i--)t.apply(o,[this[s=r-i-1],s])}),s=r(n(Array.prototype.map)||function(t,n){var r=n||e,i=[];for(var s=0,o=this.length;s<o;++s)i.push(t.call(r,this[s],s,this));return i}),o=r(n(Array.prototype.some)||function(t,n){var r=n||e;for(var i=0,s=this.length;i<s;++i)if(t.call(r,this[i],i,this))return!0;return!1}),u="toString valueOf".split(" "),a=n(Object.keys)||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return i(u,function(n){e[n]!==Object.prototype[n]&&t.push(n)}),t},p=function(){function r(e,t,r){function f(t){return i=t.length,a=s[i]||(s[i]=e.peek(i)),a===t}var i,s=[],u="",a="";while(!e.eof()){s.length=0;if(r===o(t,f))return r?e.seek(i):(a=m(u),u=u.length>0?u.substr(0,u.length-1):""),n.create(u,a);a=e.read();if(!a)break;u+=a}return n.create(u,a)}var e=function(e){this.text=(e||"")+"",this.position=-1,this.length=this.text.length},n=e.Chunk=function(e,t){this.value=e||"",this.next=t||"";if(!e&&!t)return"";this.length=(this.value+this.next).length};return f(n.prototype,{length:0,toString:function(){return this.value+this.next+""}}),n.create=function(e,t){return!e&&!t?"":new n(e,t)},f(e.prototype,{eof:function(){return this.position>=this.length},read:function(e){var t=this.peek(e);return this.position=Math.min(this.length,this.position+(e||1)),t},readAll:function(){if(this.position>=this.length)return t;var e=this.text.substr(this.position+1);return this.position=this.length,e},peek:function(e){return this.position+1>=this.length?t:this.text.substr(this.position+1,e||1)},seek:function(e,t){return this.position=Math.max(0,Math.min(this.length,(t===0?0:t===2?this.length:this.position)+(e||1))),this.position===this.length},readUntil:function(e){return typeof e=="string"&&(e=[].slice.call(arguments)),r(this,e,!0)},readWhile:function(e){return typeof e=="string"&&(e=[].slice.call(arguments)),r(this,e,!1)}}),e}(),d=/^[a-z0-9\._]+/i,v=/^[a-z]+(?:\:[a-z]+)?/i;p.prototype.readWhitespace=function(){return this.readWhile("\r","\n","	"," ")},p.prototype.readQuoted=function(e){var t="",n;for(;;){n=this.readUntil(e);if(!n)break;t+=n.value+n.next;if(m(n.value)!=="\\")break}return t},p.prototype.readQuotedUntil=function(e){var t="",n;typeof e=="string"&&(e=[].slice.call(arguments)),e=['"',"'","@*"].concat(e);while(!!(n=this.readUntil(e))){t+=n.value;if(n.next==='"'||n.next==="'")t+=n.next+this.readQuoted(n.next);else{if(n.next!=="@*")break;this.readUntil("*@")}}return p.Chunk.create(t,n.next)},p.prototype.readBlock=function(e,t,n){var r,i=[e,t],s="";n=n||0;while(!!(r=this.readUntil(i))){s+=r.value,r.next===e?n++:r.next===t&&n--;if(n===0)return s+=r.next,s;s+=r.next}return s};var g=function(e,t){this.code=e||"",this.type=t||0};f(g.prototype,{type:0,code:"",toString:function(){var e=this.code;return this.type===0?e:this.type===2?'page.writeLiteral("'+c(e)+'");':"page.write("+e+");"}});var y='var page = this, writer = page.writer, model = page.model, html = page.html;\n#1\n#2\n#0\nreturn writer.join("");',w={encode:function(e){if(e===null||e===t)e="";return e.isHtmlString?e:(typeof e!="string"&&(e+=""),e=e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;"),w.raw(e))},attributeEncode:function(e){return w.encode(e)},raw:function(e){return h(e)},renderPartial:function(e,t){return this.raw(N.view(e)(t))}},E={html:w,write:function(e){this.writeLiteral(this.html.encode(e))},writeLiteral:function(e){this.writer.push(e)},sections:{},isSectionDefined:function(e){return typeof this.sections[e]=="function"},renderSection:function(e,t){if(this.isSectionDefined(e))return h(this.sections[e]());if(t)throw'Section "'+e+'" not found.'}},x={},N={view:T,compile:S,parse:b,findView:null,basePage:E,Cmd:g,extend:f,render:function(e,t,n){return S(e)(t,n)}},C=e.document.getElementsByTagName("script");N.findView=function(t,n){for(var r=0,i=C.length,s;r<i&&(s=C[r]);r++)if(s.type==="application/x-razor-js"&&s.getAttribute("data-view-id")===t)return typeof n=="function"&&n(s.innerHTML),s.innerHTML},e.Razor=N})(window);